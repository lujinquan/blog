<div class="searchbox">
  <div class="search">
    <form action="/search.html" method="post" name="searchform" id="searchform">
      <input name="keyboard" id="keyboard" class="input_text" value={if condition="isset($keyboard) && $keyboard"}{$keyboard}{else /}请输入关键字词{/if} style="color: rgb(153, 153, 153);" onfocus="if(value=='请输入关键字词'){this.style.color='#000';value=''}" onblur="if(value==''){this.style.color='#999';value='请输入关键字词'}" type="text">
      <input name="page" value="1" type="hidden">
      <!-- <input name="show" value="title" type="hidden">
      <input name="tempid" value="1" type="hidden">
      <input name="tbname" value="news" type="hidden"> -->
      <input name="button" class="input_submit" value="搜索" type="button">
      <!-- <input name="submit" class="input_submit" value="搜索" type="submit"> -->
    </form>
  </div>
  <div class="searchclose"></div>
</div>
<script type="text/javascript">
// 回车搜索
$("#searchform").keydown(function() {
  if(event.keyCode == "13"){ //keyCode=13是回车键
    global_search();
    return false;
  }
});
$('.input_submit').click(function(){
  global_search();
});

function global_search(){
  var formData = $('#searchform').serialize(); //序列化表单数据
  var keyborad = $('.input_text').val();
  console.log('关键词：',keyborad);
  if(keyborad == '' || keyborad == '请输入关键字词'){
    return false;
  }
  //验证表单数据
  console.log('表单内容：',formData);
  $.ajax({
      type: 'POST',
      url: "/search.html",
      data: formData,
      processData : false,
      contentType : false,
      complete:function(){
         // $('.loading').hide();
         // $("#photoForm input").val('');
      },
      success:function(res){
        console.log('返回的数据：',res);
        if(res.code || res.total_data == 0){
          alert('搜索结果为空');
        }else{
          html = '';
          html += '<div class="whitebg lanmu"> <img src="/static/home/lost_time/images/search_banner.jpg">';
          html += '<h1>全栈搜索</h1>';
          html += '<p>搜一搜，找一找……。</p>';
          html += '</div>';
          html += '<div class="whitebg bloglist">';
          // 搜索的文章列表
          html += '<ul>';
          for(i in res.searchArticles){
            html += '<li>';
            html += '<h3 class="blogtitle"><a href="index/'+ res.searchArticles[i]['article_id'] +'.html" target="_blank">'+ res.searchArticles[i]['article_title'] +'</a></h3>';
            html += '<p class="blogtext">'+ res.searchArticles[i]['article_desc'] +'</p>';
            html += '<p class="bloginfo"><i class="avatar"><img src="/static/home/lost_time/images/avatar.jpg"></i><span>'+ res.searchArticles[i]['author'] +'</span><span>'+ res.searchArticles[i]['ctime'] +'</span><span>【<a href="javascript:;">原创</a>】</span></p>';
            html += '<a href="index/'+ res.searchArticles[i]['article_id'] +'.html" target="_blank" class="viewmore">阅读更多</a> </li>';
          }
          html += '</ul>';
          // 搜索的文章列表分页栏
          html += '<div class="pagelist">';
          html += '<a title="Total record">&nbsp;<b>总数：'+ res.total_data +'条</b> </a>&nbsp;&nbsp;&nbsp;';

          if(res.total_page > 1 && res.page > 1){ //如果当前页码和总页码都大于1
            html += '<a href="javascript:;" onclick="gotoPage(1)" data-href="/search/page/1.html">首页</a>&nbsp;';
            html += '<a href="javascript:;" onclick="gotoPage('+ (res.page-1) +')">上一页</a>&nbsp;';
          }
          for (var k = 1; k <= res.total_page; k++) {
            if(k == res.page){ //如果页码等于当前页码，高亮显示
              html += '<b>'+ k +'</b>';
            }else{
              html += '<a href="javascript:;" onclick="gotoPage('+ k +')" class="search_page">'+ k +'</a>&nbsp;';
            }           
          }
          if(res.total_page > 1 && res.page < res.total_page){ //如果当前页码小于总页码，且总页码大于1
            html += '<a href="javascript:;" onclick="gotoPage('+ (res.page+1) +')" class="search_page">下一页</a>&nbsp;';
            html += '<a href="javascript:;" onclick="gotoPage('+ res.total_page +')">尾页</a>';
          }
          html += '</div>';
          
          html += '</div>';

          $('.lbox').html(html);
        }
     }
  });
};

function gotoPage(page){
  console.log('跳转的页码：',page);
  $('input[name=page]').val(page);
  global_search();
}
// 动态事件绑定
// $('.lbox').on('click','.search_page',function(){
//   console.log(111);
// })
</script>